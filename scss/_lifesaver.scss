// LifeSaver - 1.1.0
// July 24, 2015
// The MIT License (MIT)
// Copyright (c) 2015 Dustin Dowell
// github.com/dustindowell22/lifesaver
// =============================================================================


@mixin ls($properties, $values, $units: null, $scale: null, $flag: null) {
  $unit-functions: em rem px pct vw vh;
  $length: length($values);

  // Check if $flag contains x or null
  $flag: if(is-null($flag), null, $flag);

  // Compress matching values to shorthand
  @if $length == 4 {
    $top: nth($values, 1);
    $right: nth($values, 2);
    $bottom: nth($values, 3);
    $left: nth($values, 4);

    @if $top == $bottom and $left == $right {
      $values: $top, $right;
      $length: 2;
    }
    @else if $top == $right and $top == $bottom and $top == $left {
      $values: $top;
      $length: 1;
    }
  }
  @else if $length == 2 {
    $top-bottom: nth($values, 1);
    $left-right: nth($values, 2);

    @if $top-bottom == $left-right {
      $values: $top-bottom;
      $length: 1;
    }
  }

  // Loop though properties
  @each $property in $properties {

    // Split output into multiple properties
    @if is-null($values) or $property == position  {

      // Set map scope
      $suffix-map: ();

      // Assign $values values to $suffix-map
      @if $length == 2 or $length == 4 {
        @if $property == border-radius {
          $suffix-map: (
            top-left: nth($values, 1),
            top-right: nth($values, 2),
            bottom-right: if($length == 2, nth($values, 1), nth($values, 3)),
            bottom-left: if($length == 2, nth($values, 2), nth($values, 4))
         );
        }
        @else {
          $suffix-map: (
            top: nth($values, 1),
            right: nth($values, 2),
            bottom: if($length == 2, nth($values, 1), nth($values, 3)),
            left: if($length == 2, nth($values, 2), nth($values, 4))
         );
        }
      }

      // Prepare property suffixes and output
      @each $unit in $units {
        @each $suffix-key in map-keys($suffix-map) {
          $value: map-get($suffix-map, $suffix-key);

          // Append suffix when needed
          @if $property == border-width {
            $suffix-key: 'border-' + $suffix-key + '-width';
          }
          @else if $property == border-radius {
            $suffix-key: 'border-' + $suffix-key + '-radius';
          }
          @else if $property == margin or $property == padding {
            $suffix-key: $property + '-' + $suffix-key;
          }

          // Output
          @if not is-null($value) {
            @if $value == 0 or type-of($value) == string {
              #{$suffix-key}: append($value, $flag);
            }
            @else if function-exists($unit) {
              #{$suffix-key}: append(call($unit, $value, $scale), $flag);
            }
            @else {
              @warn 'LifeSaver: You used an invalid unit type.';
            }
          }
        }
      }
    }

    // Concatenate shorthand values and output
    @else if $length == 1 or $length == 2 or $length == 4 {
      @each $unit in $units {

        // Set list scope
        $result: null;

        // Concatenate shorthand output
        @each $value in $values {
          @if $value == 0 or type-of($value) == string {
            $result: append($result, $value);
          }
          @else if function-exists($unit) {
            $result: append($result, call($unit, $value, $scale));
          }
          @else {
            @warn 'LifeSaver: You used an invalid unit type.';
          }
        }

        // Output
        #{$property}: append($result, $flag);
      }
    }
  }
}
